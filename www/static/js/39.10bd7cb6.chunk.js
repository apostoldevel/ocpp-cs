(this["webpackJsonpocpp-cs"]=this["webpackJsonpocpp-cs"]||[]).push([[39],{1124:function(e,t,s){"use strict";s.r(t);var a=s(2),i=s(0),n=s.n(i),c=s(172),r=s(100),l=s(102),o=s(389),h=s(601),d=s(127),m=s(693),j=s(681),p=s(603),b=s(764),u=s(1117),x=s(599),g=s(595),O=s(653),f=s(654),v=s(19),w=s(128);const y={maxWidth:2e3,maxHeight:2e3,quality:.8};var S=s(733),k=s(649),C=s(3);class R extends n.a.Component{constructor(e){var t;super(e),t=this,this.m=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"userprofile.";const{intl:a}=t.props;return a.formatMessage({id:s+e})},this.save=async e=>{const{user:t}=this.props;this.setState({pending:!0}),await this.context.api.q("/user/set",{username:t.raw.profile.username,password:e.password,email:e.email,name:e.name})?(o.b.success(this.m("save.success","")),this.onAfterSave()):(o.b.error(this.m("save.fail","")),this.setState({pending:!1}))},this.changePassword=async e=>{this.setState({pending:!0}),await this.context.api.q("/user/password",{oldpass:e.oldpass,newpass:e.newpass})?(o.b.success(this.m("save.success","")),this.onAfterSave()):(o.b.error(this.m("save.fail","")),this.setState({pending:!1}))},this.prepareAvatar=async()=>{if(this.state.fileInputRef.current)if(this.state.fileInputRef.current.files[0]){this.setState({pending:!0});const e=this.state.fileInputRef.current.files[0],t=window.appConfig.maxFileSize;if(t&&e.size>t)return o.b.error("".concat(this.m("file.size.exceed",""),": ").concat(Math.round(t/1024)," ").concat(this.m("kb",""))),void this.setState({pending:!1});let{readerResult:s}=await Object(S.a)(e);(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=document.createElement("canvas"),a=document.createElement("img"),{maxWidth:i,maxHeight:n,quality:c}=Object.assign(y,t);return new Promise((t,r)=>{a.onload=function(){let e=a.width,r=a.height;e>r?e>i&&(r=Math.round(r*=i/e),e=i):r>n&&(e=Math.round(e*=n/r),r=n),s.width=e,s.height=r,s.getContext("2d").drawImage(a,0,0,e,r),t(s.toDataURL("image/jpeg",c))},a.onerror=function(e){t(!1)},a.src=e})})(s,{maxWidth:200,maxHeight:200}).then(e=>{e?this.saveAvatar(e):(o.b.error(this.m("file.read.failed","")),this.setState({pending:!1}))})}else this.modalHide();else this.modalHide()},this.saveAvatar=async e=>{this.setState({pending:!0}),await this.context.api.q("/user/profile/set",{picture:e})?(o.b.success(this.m("save.success","")),this.onAfterSave()):(o.b.error(this.m("save.fail","")),this.setState({pending:!1}))},this.modalShow=()=>{this.setState({modalShow:!0})},this.modalHide=()=>{this.setState({modalShow:!1})},this.onAfterSave=()=>{document.location.reload()},this.state={pending:!1,moodalShow:!1,fileInputRef:n.a.createRef()}}render(){const{user:e}=this.props,{pending:t,modalShow:s,fileInputRef:i}=this.state,n={labelCol:{span:8},wrapperCol:{span:16}};return Object(C.jsxs)("div",{children:[Object(C.jsx)(l.a,{children:Object(C.jsx)("title",{children:this.m("profile")})}),Object(C.jsx)(h.a,{title:this.m("avatar.change"),open:s,onOk:this.prepareAvatar,onCancel:this.modalHide,footer:[Object(C.jsx)(d.a,{onClick:this.modalHide,children:this.m("cancell","")},"cancell"),Object(C.jsx)(d.a,{onClick:()=>this.saveAvatar(""),children:this.m("avatar.remove")},"remove"),Object(C.jsx)(d.a,{type:"primary",loading:t,onClick:this.prepareAvatar,children:this.m("save","")},"submit")],children:Object(C.jsx)(m.a,{spinning:t,children:Object(C.jsx)("input",{ref:i,type:"file",className:"form-control"})})}),Object(C.jsx)("h2",{className:"title gx-mb-4",children:this.m("profile")}),Object(C.jsx)(j.a,{children:Object(C.jsxs)(w.a,{between:!0,className:"flex-reset-lg",children:[Object(C.jsxs)(w.a,{wrap:!0,children:[Object(C.jsx)("div",{className:"gx-pointer",onClick:this.modalShow,children:e.show.picture?Object(C.jsx)(p.a,{size:64,src:e.show.picture,style:{marginRight:"15px"}}):Object(C.jsx)(p.a,{size:64,style:{marginRight:"15px"},children:e.show.literal})}),Object(C.jsxs)("div",{children:[Object(C.jsx)("h5",{children:e.show.hello}),Object(C.jsxs)(b.b,{children:[Object(C.jsx)(u.a,{style:{backgroundColor:"#52c41a"},count:this.m("active")}),e.isAdmin&&Object(C.jsx)(u.a,{style:{backgroundColor:"#038FDE"},count:this.m("admin")}),e.isGuest&&Object(C.jsx)(u.a,{style:{backgroundColor:"#a0d911"},count:this.m("guest")})]})]})]}),Object(C.jsxs)("div",{className:"gx-text-right",children:[Object(C.jsxs)("div",{children:[this.m("connection"),":"]}),Object(C.jsxs)("div",{className:"gx-text-muted gx-font-weight-light gx-mt-1 break-all",children:[e.connectionLink,Object(C.jsx)("span",{className:"gx-ml-2 gx-link",onClick:()=>{navigator.clipboard.writeText(e.connectionLink),o.b.success(this.m("copied"))},children:Object(C.jsx)(k.a,{})})]}),Object(C.jsx)("div",{children:Object(C.jsx)("small",{children:this.m("connectionHint")})})]})]})}),Object(C.jsx)(j.a,{children:Object(C.jsx)(m.a,{spinning:t,children:Object(C.jsxs)(x.a,Object(a.a)(Object(a.a)({name:"basic",onFinish:this.save,className:"gx-signin-form gx-form-row0",autoComplete:"off"},n),{},{children:[Object(C.jsx)(x.a.Item,{rules:[{required:!0,type:"email",message:this.m("email.invalid")}],name:"email",label:this.m("email"),initialValue:e.raw.profile.email,children:Object(C.jsx)(g.a,{placeholder:this.m("email")})}),Object(C.jsx)(x.a.Item,{rules:[{required:!0,message:this.m("name.invalid")}],name:"name",label:this.m("name"),initialValue:e.raw.profile.name,children:Object(C.jsx)(g.a,{placeholder:this.m("name")})}),Object(C.jsxs)(O.a,{children:[Object(C.jsx)(f.a,{span:8}),Object(C.jsx)(f.a,{span:16,children:Object(C.jsx)(d.a,{type:"primary",htmlType:"submit",loading:t,children:this.m("save","")})})]})]}))})}),Object(C.jsxs)("h2",{className:"gx-mb-4",children:[this.m("passchange")," "]}),Object(C.jsx)(j.a,{children:Object(C.jsx)(m.a,{spinning:t,children:Object(C.jsxs)(x.a,Object(a.a)(Object(a.a)({name:"basic",onFinish:this.changePassword,className:"gx-signin-form gx-form-row0",autoComplete:"off"},n),{},{children:[Object(C.jsx)(x.a.Item,{rules:[{required:!0}],label:this.m("oldpass"),name:"oldpass",children:Object(C.jsx)(g.a.Password,{})}),Object(C.jsx)(x.a.Item,{rules:[{required:!0}],label:this.m("newpass"),name:"newpass",children:Object(C.jsx)(g.a.Password,{})}),Object(C.jsxs)(O.a,{children:[Object(C.jsx)(f.a,{span:8}),Object(C.jsx)(f.a,{span:16,children:Object(C.jsx)(d.a,{type:"primary",htmlType:"submit",loading:t,children:this.m("change","")})})]})]}))})})]})}}R.contextType=r.a;t.default=Object(v.c)(e=>({user:e.user}),null)(Object(c.c)(R))},733:function(e,t,s){"use strict";function a(e){return new Promise((t,s)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>{const e=a.result,s=e.toString(),i=/^data:(.*,)?/;let n=s.match(i)[0],c=s.replace(i,"");c.length%4>0&&(c+="=".repeat(4-c.length%4)),t({encoded:c,type:n,readerResult:e})},a.onerror=e=>s(e)})}s.d(t,"a",function(){return a})}}]);
//# sourceMappingURL=39.10bd7cb6.chunk.js.map